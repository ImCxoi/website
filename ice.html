<!DOCTYPE html>
<html>
    <head>
        <html lang="en"></html>
        <title>Cxoi.net</title>
        <h1 class="centered">(K)notty Generator</h1>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="color-scheme" content="light dark"/>
        <link rel="stylesheet" href="ice.css"/>
        <link rel="icon" type="image/png" href="images/ice.png"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://lonekorean.github.io/highlight-within-textarea/jquery.highlight-within-textarea.js"></script>
    </head>
    <body">
        <div class="container">
            <div class="box"></div>
                <textarea type="text" class="textarea" name="plot" id="plot" placeholder="Enter text here" oninput="countWord()" onpaste="paste()"></textarea>
                <button type="button" class="buttongui" onclick="doWork()">Generate</button>
            </div>
            <div class="count">Word Count: <span id="show">0</span></div>
            <script>
                const dict = ["can't","couldn't","don't","nonchalant","noncompliant","noncommittal","nonconformist","nonexistent","nonessential","nonfunctional","nonplussed","nonrenewable","nonresponsive","nonverbal","nonviolent","nobody","no","none","nor","not","notorious","nothing","nowhere","shouldn't","won't","wouldn't"];
                const editText = dict.map(i => 'xx' + i);     
                const dictRegex = new RegExp("\\b(" + dict.join("|") + ")\\b", "gi");  
                const $textarea = $('.textarea');
                let matches = [];
                let text = [];
                let $count = [];
                let count = matches.length;

                $textarea.highlightWithinTextarea({
                    highlight: dictRegex
                });

                function countWord() {
                    text = $('#plot').val();
                    $count = $('#show');
                    count = matches.length
                    matches = text.match(dictRegex) || [];
                    $count.text(count);
                }
                
                function doWork() {
                    if (count > 0) {
                        const changeText = text.replace(dictRegex, function(match) {return "xx" + match;});
                        $textarea.val(changeText);
                        $textarea.highlightWithinTextarea({
                            highlight: editText,
                        });
                    }
                    $count.text(count);
                    
                }
                function paste() {
                    setTimeout(function() {
                        $textarea.scrollTop(0);
                        countWord()
                    }, 0);
                }

                //function togglestyle(test){
                //    if(test.className === "on") {
                        
                //        document.getElementById('btn').value = "Keep Formatting: ❌"
                //        test.className="off";
                //    } else {
                        
                //        test.className="on";
                //        document.getElementById('btn').value = "Keep Formatting: ✔️"
                //    }
                //}
                "use strict";
                document.body.style.zoom="100%"
            </script>  
        </body>
    </body>
</html>