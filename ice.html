<!DOCTYPE html>
<html>
    <head>
        <html lang="en"></html>
        <title>Cxoi.net</title>
        <h1 class="centered">(K)notty Generator</h1>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <meta name="color-scheme" content="light dark"/>
        <link rel="stylesheet" href="ice.css"/>
        <link rel="icon" type="image/png" href="images/ice.png"/>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="https://lonekorean.github.io/highlight-within-textarea/jquery.highlight-within-textarea.js"></script>
    </head>
    <body">
        <div class="container">
            <div class="box"></div>
                <textarea type="text" class="textarea" name="plot" id="plot" placeholder="Enter text here" oninput="countWord()"></textarea>
            </div>
            <script>
                document.body.style.zoom="100%"
                var dict = [" not ", " don't ", " can't ", " won't ", " wouldn't ", " couldn't ", " shouldn't "];
                var editText = dict.map(i => 'xx' + i.slice(1));
                $('.textarea').highlightWithinTextarea({
                    highlight: editText
                });
                function countWord() {    

                    var words = document.getElementById("plot").value;
                    var count = 0;
                    var split = words.split(' ');
                    for (var i = 0; i < split.length; i++) {
                        if (split[i] != "") {
                            ele = document.getElementsByClassName("hwt-highlights hwt-content")[0]
                            if (ele.getElementsByTagName('mark').item(i)) {
                                count += 1;
                            } 
                        }
                    }
                    document.getElementById("show").innerHTML = count;
                }
                function doWork() {

                    for (i=0; i<dict.length; i++) {
                    var text = $('.textarea').val()

                        contains = dict.some(element => {
                            

                            if (text.includes(element)) {
                                
                                if (element.indexOf(' ') >= 0) {
                                    var changeText = text.replaceAll(element, " xx" + element.slice(1))
                                    $('.textarea').val(changeText);
                                    //if (document.getElementById('btn').className == 'on') {
                                    //    $('.textarea').val(changeText);
                                    //}
                                    //else {
                                    //    $('.textarea').val(changeText.replace(/\n/g, ' '));
                                    //}
                                    
                                }
                            
                            } 
                            
                        });
                    }
                $('.textarea').highlightWithinTextarea({
                    highlight: editText
                });
                countWord()
                }
                function togglestyle(test){
                    if(test.className === "on") {
                        
                        document.getElementById('btn').value = "Keep Formatting: ❌"
                        test.className="off";
                    } else {
                        
                        test.className="on";
                        document.getElementById('btn').value = "Keep Formatting: ✔️"
                    }
                }
                
            </script>  
        </body>
        <button type="button" class="buttongui" onclick="doWork()">Generate</button>
        
        <div class="count"> Word Count:
            <span id="show">0</span>
        </div>
    </body>
</html>
